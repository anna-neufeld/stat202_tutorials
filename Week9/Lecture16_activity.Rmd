---
title: "Lecture 16: Exploring multiple regression"
output:
  html_document:
    css: ../lab.css
    highlight: pygments
    theme: cerulean
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(eval = FALSE)
library(tidyverse)
library(openintro)
```


<div id="boxedtext">
**Learning Objectives**: See how coefficients, p-values, and predictions change when you add and remove variables from a multiple linear regression model. 
</div>

<div id="boxedtext">
**Instructions**: Submit written answers to anything marked "quiz question" on pencil and paper! This activity is Mini Quiz 6! 
</div>

```{r, echo=F, eval=T}
setwd("~/stat202_tutorials/Week9")
n <- 30
set.seed(1)
x1 <- rnorm(30)
x1 <- x1-mean(x1)
x2 <- x1+rnorm(30, sd=0.04)
x4 <- 1/2*x1
x5 <- rnorm(x1, sd=0.25)
x6 <- rnorm(30)
x3 <- x6 - sum(x1*x6)/(sum(x1^2))*x1
x7 <- rnorm(30)
y <- 1*x1+2*x2+3*x3+4*x4+5*x5+6*x6+7*x7+rnorm(30, sd=3)
dat.small <- data.frame(cbind(y,x1,x2,x3,x4,x5,x6,x7))
write.csv(dat.small, file=c("dat.small.csv"))

X <- MASS::mvrnorm(30, mu=rep(0,29), Sigma=diag(29))
y <- 3*X[,1]+5*X[,5]+rnorm(30)
dat.big <- data.frame(cbind(y,X))
names(dat.big)[2:30] <- paste0("x", 1:29)
write.csv(dat.big, file=c("dat.big.csv"))


X <- MASS::mvrnorm(30, mu=rep(0,30), Sigma=diag(30))
y <- 3*X[,1]+5*X[,5]+rnorm(30)
dat.big.test <- data.frame(cbind(y,X))
names(dat.big.test)[2:31] <- paste0("x", 1:30)
write.csv(dat.big.test, file=c("dat.big.test.csv"))
```

# Getting Started 

I made you three fake datasets to explore some properties of multiple regression. Download them with the following code:

```{r, eval=F}
library(tidyverse)
dat.small <- read.csv("https://anna-neufeld.github.io/stat202_tutorials/Week9/dat.small.csv")
dat.big <- read.csv("https://anna-neufeld.github.io/stat202_tutorials/Week9/dat.big.csv")
dat.big.test <- read.csv("https://anna-neufeld.github.io/stat202_tutorials/Week9/dat.big.test.csv")
```
# 1. Starting with dat.small

This dataset has 30 observations, one response variable `y`, and $7$ predictor variables `x1`, `x2`, ..., `x7`. The following code will show you relationships between all of your variables.

```{r, fig.height=6, fig.width=6, eval=T}
pairs(dat.small)
```

Note that the following code and output tells you about the pairwise correlations between all variables in your dataset.

\tiny
```{r, echo=T, eval=F}
cor(dat.small)
```

```{r, echo=F, eval=T, warning=F, message=F}
library(tidyverse)
library(knitr)
library(kableExtra)
cor(dat.small) %>%kable()%>%
  kable_styling(font_size = 10)
```
The *pairs* plot and the *correlation matrix* above may help you answer some of the questions below!

**1a.** Compare a linear regression of `y` on `x1` to a linear regression of `y` on `x1` and `x2`. What do you notice about the coefficients, p-values, and $R^2$? To explain your answer, you may want to consider the correlation between `x1` and `x2`. 

```{r}
summary(lm(y~x1, data=dat.small))
summary(lm(y~x1+x2, data=dat.small))
```



**1b.** Compare a linear regression of `y` on `x1` to a linear regression of `y` on `x1` and `x3`. What do you notice about the coefficients, p-values, and $R^2$? To explain your answer, you may want to consider the relationship between `x1` and `x3`. 

```{r}
summary(lm(y~x1, data=dat.small))
summary(lm(y~x1+x3, data=dat.small))
```

**1c.** What happens if you fit a linear regression of `y` on `x1` and `x5` and `x6`. Compare this to the answer in parts a and b. Can you explain your answer by looking at the correlations between all of the x variables. 

**1d.** What happens if you fit a linear regression of `y` on `x1` and `x3`


**1e.** Fit a linear regression of `y` on `x1+x2+x3+x5+x6+x7``. How do you feel about this final model? If you have time, consider diagnostics, etc. 


# 2. Moving on to dat.big

This dataset has 30 observations and 30 variables. The following command will let you fit a regression of `y` on all other variables in the dataset.

```{r}
mod.full <- lm(y~., data=dat.big)
```

What do you notice about $R^2$ and your predictions? 


# 3. Bringing in the test set

The dataset ``test.big`` comes from exactly the same po






*** 
## Acknowledgements

The formatting of this tutorial was adopted from an OpenIntro lab. <div id="license">
This is a product of OpenIntro that is released under a 
[Creative Commons Attribution-ShareAlike 3.0 Unported](http://creativecommons.org/licenses/by-sa/3.0). 
</div>

